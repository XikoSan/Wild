{% load dict_key %}
{% load get_attr %}
{% load get_sum %}
{% load get_key_list %}
<div class="row draft_row" id="GeologicalSurveys" style="display: none">
    <script>
        var survey_total_stocks = {};
    {% with regions=data|dict_key:'regions' %}
        {% for region in regions %}
            survey_total_stocks["{{ region.pk }}"] = {};
            {% with resources=data|dict_key:'resources' %}
                {% for resource in resources|get_key_list %}

                    {% with res_cap=resource|get_sum:'_cap' %}
                    {% with res_depletion=resource|get_sum:'_depletion' %}

                        survey_total_stocks["{{ region.pk }}"]["{{ resource }}_cap"] = {{ region|get_attr:res_cap }};

                        survey_total_stocks["{{ region.pk }}"]["{{ resource }}_depletion"] = {{ region|get_attr:res_depletion }};

                    {% endwith %}
                    {% endwith %}

                {% endfor %}
            {% endwith %}
        {% endfor %}
    {% endwith %}

    // выводить информацию по запасам в регионах
    jQuery(document).ready(function ($) {
        $('#survey_regions').change(function(e) {
            $('#survey_res_line').hide();
            $('#survey_sum_line').hide();
            // если значение ресурса не пустое
            if($('#survey_resources').val() != null){
                $('#survey_res_cap').html(survey_total_stocks[$(e.target).val()][$('#survey_resources').val()+'_cap'])
                $('#survey_res_depletion').html(survey_total_stocks[$(e.target).val()][$('#survey_resources').val()+'_depletion'])

                need_val = parseInt(survey_total_stocks[$(e.target).val()][$('#survey_resources').val()+'_depletion'])
                need_sum = parseInt((need_val).toFixed(2) * 10)
                $('#survey_sum').html(numberWithSpaces(need_sum))

                $('#survey_res_line').show();
                $('#survey_sum_line').show();
            }
        });
        $('#survey_resources').change(function(e) {
            $('#survey_res_line').hide();
            $('#survey_sum_line').hide();
            // если значение ресурса не пустое
            if($('#survey_regions').val() != null){
                $('#survey_res_cap').html(survey_total_stocks[$('#survey_regions').val()][$(e.target).val()+'_cap'])
                $('#survey_res_depletion').html(survey_total_stocks[$('#survey_regions').val()][$(e.target).val()+'_depletion'])

                need_val = parseInt(survey_total_stocks[$('#survey_regions').val()][$(e.target).val()+'_depletion'])
                need_sum = parseInt((need_val).toFixed(2) * 10)
                $('#survey_sum').html(numberWithSpaces(need_sum))

                $('#survey_res_line').show();
                $('#survey_sum_line').show();
            }
        });
    });
    </script>
    <div class="col-xs-6 col-sm-6 col-md-6">
        <div class="row" style="margin-top: 25px;">
            {% with regions=data|dict_key:'regions' %}
            <select name="survey_regions" id="survey_regions" style="height: 20px; min-width: 20%">
                <option id="survey_region_default" value='default' disabled selected value>Выберите регион разведки</option>
                {% for region in regions %}
                <option id="survey__region_{{ region.pk }}" value="{{ region.pk }}">{{ region.region_name }}</option>
                {% endfor %}
            </select>
            {% endwith %}
        </div>
        <div class="row" style="margin-top: 25px;">
            {% with resources=data|dict_key:'resources' %}
            <select name="survey_resources" id="survey_resources" style="height: 20px; min-width: 20%">
                <option id="survey_resource_default" value='default' disabled selected value>Выберите ресурс</option>
                {% for resource in resources|get_key_list %}
                <option id="survey_resource_{{ resource }}" value="{{ resource }}">{{ resources|dict_key:resource }}</option>
                {% endfor %}
            </select>
            {% endwith %}
        </div>
    </div>
    <div class="col-xs-6 col-sm-6 col-md-6">
        <div class="row" id="survey_res_line" style="margin-top: 25px; display: none">
            Запасы:<div id="survey_res_cap" style="display: inline-block;"></div> / <div id="survey_res_depletion" style="display: inline-block;"></div>
        </div>
        <div class="row" id="survey_sum_line" style="margin-top: 25px; display: none">
            Стоимость разведки: <b><div id="survey_sum" style="display: inline-block"></div> Буровых установок</b>
        </div>
    </div>
</div>