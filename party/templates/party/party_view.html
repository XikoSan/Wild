{% extends 'player/header.html' %}
{% load static %}
{% load i18n %}{% load tz %}
{% load dict_key %}
{% load has_key %}
{% load government.treasury %}

{% block for_scripts_and_css %}
<script src='{% static "js/region_view.js" %}?{{ csrf_token }}'></script>
{% endblock %}

{% block content %}
<div id="over" class="tabcontent">
        <div class="row">
            <div class="col-xs-1 col-sm-1 col-md-1" align="center"></div>
            <div class="col-xs-4 col-sm-4 col-md-4" align="center">
                <div class="row">
                    <div align="center" style="height: 50px; font-size: 20pt; font-weight: bold;">{{ party.title }}</div>
                </div>
                <div class="row">
                    {% if party.image %}
                    <!--Картинка партии-->
                    <img src="{{ party.image.url }}" width="250" height="250">
                    {% else %}
                    <img src="{% static 'img/nopic_party.png' %}" width="250" height="250">
                    {% endif %}
                </div>
                <div class="row">
                {% if not party.deleted %}
                    {% if not player.party %}
                        {% if party.type == 'op' %}
                            <a href="{% url 'party_joiner' plr_pk=player.pk pty_pk=party.pk %}" class="btn btn-success">Вступить</a>
                        {% endif %}
                        {% if party.type == 'pt' %}
                            {% if has_request %}
                                <a href="{% url 'party_cancel' plr_pk=player.pk pty_pk=party.pk %}" class="btn btn-danger">Отменить заявку</a>
                            {% else %}
                                <a href="{% url 'party_request' plr_pk=player.pk pty_pk=party.pk %}" class="btn btn-success">Подать заявку</a>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
                </div>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-6">
                <div class="row">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#data">Информация</a></li>
                        <li><a data-toggle="tab" href="#members">Состав</a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="data" class="tab-pane fade in active" style="overflow-x: hidden; height: 500px">
                            <div class="row flex" style="margin-top: 15px">
                                <div class="col-xs-6 col-sm-6 col-md-6" align="left">
                                    <b><font size="4">Участников:</font></b>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6">
                                    <b><font size="4">{{ players_count }}</font></b>
                                </div>
                            </div>
                            <div class="row flex" style="margin-top: 15px">
                                <div class="col-xs-6 col-sm-6 col-md-6" align="left">
                                    <b><font size="4">Тип:</font></b>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6">
                                    <b><font size="4">{{ party.get_type_display }}</font></b>
                                </div>
                            </div>
                            <div class="row flex" style="margin-top: 15px">
                                <div class="col-xs-6 col-sm-6 col-md-6" align="left">
                                    <b><font size="4">{% trans 'Регион' %}:</font></b>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6">
                                    <b>
                                        <img src='/static/img/regions/{{ party.region.on_map_id }}.png' class='image' width='30' height='30' onclick="window.location.href = '/region/{{ party.region.pk }}/'" style="cursor: pointer">
                                        <font size="4" onclick="window.location.href = '/region/{{ party.region.pk }}/'" style="cursor: pointer">{{ party.region.region_name }}</font>
                                    </b>
                                </div>
                            </div>
                            <div class="row flex" style="margin-top: 15px">
                                <div class="col-xs-6 col-sm-6 col-md-6" align="left">
                                    <b><font size="4">Дата основания:</font></b>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6">
                                    <b><font size="4">{{ party.foundation_date|timezone:player.time_zone|date:"d.m.Y H:i" }}</font></b>
                                </div>
                            </div>
                        </div>
                        <div id="members" class="tab-pane fade" style="overflow-x: hidden; height: 500px">
                            <div style="overflow-y: auto; overflow-x: hidden;">
                            {% for member in party_characters %}
                                <div class="row flex" style="margin-top: 1%;">
                                    <div class="col-xs-2 col-sm-2 col-md-2">
                                        <a href='/profile/{{ member.pk }}' target="_blank">
                                            {% if member.image %}
                                            <img src="{{ member.image.url }}" width="50" height="50" align="left">
                                            {% else %}
                                            <img src="{% static 'img/nopic.png' %}" width="50" height="50" align="left">
                                            {% endif %}
                                        </a>
                                    </div>
                                    <div class="col-xs-4 col-sm-4 col-md-4">
                                        <a href='/profile/{{ member.pk }}' target="_blank">
                                            <font size="4"><b>{{ member.nickname }}</b></font>
                                        </a>
                                    </div>
                                    <div class="col-xs-4 col-sm-4 col-md-4">
                                        <font size="4"><b>{{ member.party_post.title }}</b></font>
                                    </div>
                                    <div class="col-xs-2 col-sm-2 col-md-2">
                                        {% if online_dict|has_key:member.pk %}
                                        <font size="4"><b>{{ online_dict|dict_key:member.pk }}</b></font>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="line"></div>
                            {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-1 col-sm-1 col-md-1" align="center"></div>
        </div>
</div>
{% endblock %}