{% extends 'player/redesign/header.html' %}
{% load static %}
{% load l10n %}{% load i18n %}{% load tz %}{% load dict_key %}
{% load get_building_info %}

{% block for_scripts_and_css %}
<script src='{% static "js/region_view.js" %}?{{ csrf_token }}'></script>
<script src='{% static "js/map.js" %}?{{ csrf_token }}'></script>

<script>
    if ( document.getElementsByClassName("to_fly").length > 0 ){
       var button = document.getElementsByClassName("to_fly")[0];
       button.addEventListener ("click", to_fly)
    }
</script>
{% endblock %}

{% block content %}
<section class="party custom-scroll">
    <style>
    .party__regionInfo-block p span {
      color: var(--c10one);
    }
    </style>
    <!-- Заголовок -->
    <h1 class="party__title ct__page-title">{{ page_name }}</h1>

    <!--ТОП БЛОК-->
    <div class="party__top">
      <!--аватар-->
      <img class="party__top-ava" src="/static/img/regions/{{ region.on_map_id }}.png">

      <!--инфа в топ блоке-->
      <div class="party__top-content">
<!--        <div class="party__top-content-textBlock">-->
<!--            <p>Жителей: <span>169</span></p>-->
<!--            <p>Граждан: <span>153</span></p>-->
<!--            <p>Партий: <span>0</span></p>-->
<!--        </div>-->

        <div class="party__region">
            {% if region.state %}
                {% if region.state.image %}
                <!--Картинка слева - герб-->
            <img src="{{ region.state.image.url }}" alt="{{ region.state.title }}" onclick="window.location.href = '/state/{{ region.state.pk }}/'" style="cursor: pointer">
                {% else %}
                <!--SVG картинка слева заглушка государства-->
            <svg width="32rem" height="32rem" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg" onclick="window.location.href = '/state/{{ region.state.pk }}/'" style="cursor: pointer">
              <g clip-path="url(#clip0_719_1078)">
              <path d="M0.491699 16.9875C0.491699 7.87313 7.87737 0.487457 16.9917 0.487457C26.106 0.487457 33.4917 7.87313 33.4917 16.9875C33.4917 26.1018 26.106 33.4875 16.9917 33.4875C7.87737 33.4875 0.491699 26.1018 0.491699 16.9875Z" stroke="var(--c10two)"/>
              <path d="M16.2592 1.71561V4.40533C16.3253 4.37682 16.4058 4.35403 16.4954 4.33842C16.5851 4.32281 16.682 4.31471 16.78 4.31464C16.9631 4.31477 17.139 4.34291 17.2706 4.39314V1.71561H16.2592ZM16.7436 5.35272C16.4899 5.35298 16.2407 5.39844 16.021 5.48455C15.8013 5.57067 15.6188 5.69442 15.4919 5.84342V6.7694C15.6339 6.71639 15.8231 6.67309 16.0432 6.64318C16.2634 6.61328 16.5081 6.59764 16.7565 6.59762C17.0082 6.59768 17.256 6.61377 17.4783 6.64448C17.7006 6.6752 17.8907 6.7196 18.0319 6.77381H18.0374C18.0402 6.76963 18.0429 6.76543 18.0456 6.76123V5.90751C17.9273 5.74146 17.7424 5.60137 17.5121 5.50326C17.2819 5.40514 17.0156 5.35297 16.7436 5.35272ZM16.7316 7.62156C16.5306 7.62348 15.664 7.66601 14.6557 8.22305C13.672 8.76649 13.127 9.41527 13.127 9.41527C13.127 9.41527 12.3711 10.1942 11.711 11.5801C11.2055 12.6412 11.0306 13.745 11.0306 13.745H22.5204C22.5204 13.745 22.3793 12.8269 21.8114 11.5801C21.2372 10.3191 20.4003 9.41527 20.4003 9.41527C20.4003 9.41527 19.489 8.51052 18.8184 8.14612C17.8005 7.59306 16.7754 7.62182 16.7754 7.62182C16.7754 7.62182 16.7603 7.62129 16.7316 7.62156ZM9.92453 14.7933L9.50676 15.6916H9.92453H23.607H24.0247L23.607 14.7933H9.92453ZM9.9837 16.7013V18.2707H10.9826V16.7013H9.9837ZM13.1217 16.7013V18.2707H14.1206V16.7013H13.1217ZM16.2597 16.7013V18.2707H17.2586V16.7013H16.2597ZM19.3977 16.7013V18.2707H20.3966V16.7013H19.3977ZM22.5489 16.7013V18.2707H23.5478V16.7013H22.5489ZM7.37247 19.2717V20.1909H26.1577V19.2717H7.37247ZM8.17779 21.1937V24.5541H9.18564V21.1937H8.17779ZM10.873 21.1937V24.5541H11.8808V21.1937H10.873ZM13.5549 21.1937V24.5541H14.5626V21.1937H13.5549ZM16.2501 21.1937V24.5541H17.2578V21.1937H16.2501ZM18.9451 21.1937V24.5541H19.953V21.1937H18.9451ZM21.6403 21.1937V24.5541H22.6482V21.1937H21.6403ZM24.3355 21.1937V24.5541H25.3433V21.1937H24.3355ZM4.69922 25.5657V27.2415H28.8281V25.5657H4.69922Z" fill="var(--c10one)"/>
              </g>
              <defs>
              <clipPath id="clip0_719_1078">
              <rect width="34" height="34" fill="var(--c10one)"/>
              </clipPath>
              </defs>
            </svg>
            {% endif %}

            <p onclick="window.location.href = '/state/{{ region.state.pk }}/'" style="margin-left: 10rem; cursor: pointer">{{ region.state.title }}</p>

            {% else %}
            <svg width="32rem" height="32rem" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4.0083 19.9797C5.79935 15.9581 6.90009 11.8186 7.22658 10.2516C9.12957 11.108 11.3777 11.7255 12.2639 11.9272C14.6893 12.672 16.5394 11.1204 17.1613 10.2516C18.5046 8.20354 19.9909 7.31917 20.5661 7.13299C22.8796 6.61167 26.1632 7.90876 27.5158 8.62246C23.1874 11.1546 23.1003 16.1009 23.5979 18.2575C20.4262 16.1722 17.3634 16.5508 16.2284 17.0007C14.027 18.0434 13.0102 19.4211 12.777 19.9797C12.0307 21.7298 9.60532 21.826 8.48591 21.6553C6.5083 21.3574 4.67683 20.4141 4.0083 19.9797Z" fill="var(--c10one)"></path>
              <path d="M18.1408 33.0126L27.9822 8.34319C28.5792 7.71017 28.915 8.26561 29.0083 8.62246L19.4001 33.0126H18.1408Z" fill="var(--c10one)"></path>
              <path d="M0.5 17C0.5 7.88567 7.88567 0.5 17 0.5C26.1143 0.5 33.5 7.88567 33.5 17C33.5 26.1143 26.1143 33.5 17 33.5C7.88567 33.5 0.5 26.1143 0.5 17Z" stroke="var(--c10two)"></path>
            </svg>
            <p style="margin-left: 10rem;">{% trans 'Независимый регион' %}</p>
            {% endif %}
        </div>

        {% if not player.residency == region %}
            {% if not player.destination %}
                {% if residency == 'free' %}
                <button onclick="get_residency({{ region.pk }})" class="party__top-content-request ct__mid-btn">
                    <svg width="144" height="30" viewBox="0 0 144 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <mask id="mask0_259_319" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="144" height="30">
                            <path d="M0 5.76923L5.76923 0H144V23.0769L137.077 30H0V5.76923Z" fill="var(--c10two)"/>
                        </mask>
                        <g mask="url(#mask0_259_319)">
                            <path d="M0 5.76917L5.76923 -6.10352e-05H144V23.0769L137.077 29.9999H0V5.76917Z" fill="var(--c10two)"/>
                            <path class="treg1" opacity="0.15" d="M109.266 13.4468L125.407 3.59524L125.868 22.4997L109.266 13.4468Z" fill="var(--c10one)"/>
                            <path class="treg2" opacity="0.15" d="M95.6185 -3.53072L103.36 25.3596L74.4694 17.6185L95.6185 -3.53072Z" fill="var(--c10one)"/>
                            <path class="treg3" opacity="0.15" d="M22.6079 -8.73057L72.591 7.62749L33.433 42.7351L22.6079 -8.73057Z" fill="var(--c10one)"/>
                        </g>
                    </svg>
                    <span style="font-size: 13rem;">получить прописку</span>
                </button>
                {% else %}
                    {% if request %}
                    <p class="profile__repost-status" style="width: 100%; max-width: 144rem; margin: inherit;">запрос отправлен</p>
                    {% else %}
                      <button onclick="get_residency({{ region.pk }})" class="party__top-content-request ct__mid-btn">
                            <svg width="144" height="30" viewBox="0 0 144 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <mask id="mask0_259_319" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="144" height="30">
                                    <path d="M0 5.76923L5.76923 0H144V23.0769L137.077 30H0V5.76923Z" fill="var(--c10two)"/>
                                </mask>
                                <g mask="url(#mask0_259_319)">
                                    <path d="M0 5.76917L5.76923 -6.10352e-05H144V23.0769L137.077 29.9999H0V5.76917Z" fill="var(--c10two)"/>
                                    <path class="treg1" opacity="0.15" d="M109.266 13.4468L125.407 3.59524L125.868 22.4997L109.266 13.4468Z" fill="var(--c10one)"/>
                                    <path class="treg2" opacity="0.15" d="M95.6185 -3.53072L103.36 25.3596L74.4694 17.6185L95.6185 -3.53072Z" fill="var(--c10one)"/>
                                    <path class="treg3" opacity="0.15" d="M22.6079 -8.73057L72.591 7.62749L33.433 42.7351L22.6079 -8.73057Z" fill="var(--c10one)"/>
                                </g>
                            </svg>
                            <span style="font-size: 13rem;">запросить прописку</span>
                        </button>
                    {% endif %}
                {% endif %}

                {% if not player.region == region %}
                <div class="map__info-btn-block" style="justify-content: inherit; width: 210rem;">
                    {% csrf_token %}
                    <input type="hidden" class="region_id" name="region" value="{% localize off %}{{ region.pk }}{% endlocalize %}">
                    <button class="to_fly" style="cursor: pointer; width: 100rem;height: 24rem;font-size: 12rem;">{% trans 'отправиться' context "map" %}</button>
                    <!--время перелёта-->
                    <span class="map__info-btn-time" style="font-size: 10rem;">
                      <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 20rem;height: 20rem;">
                        <g clip-path="url(#clip0_1186_860)">
                        <path d="M4.99997 9.64265C7.56415 9.64265 9.64283 7.56397 9.64283 4.99979C9.64283 2.43561 7.56415 0.356934 4.99997 0.356934C2.43579 0.356934 0.357117 2.43561 0.357117 4.99979C0.357117 7.56397 2.43579 9.64265 4.99997 9.64265Z" stroke="var(--c10one)"></path>
                        <path d="M5 1.6001V5.0501L7.65 7.7001" stroke="var(--c10one)"></path>
                        </g>
                        <defs>
                        <clipPath id="clip0_1186_860">
                        <rect width="10" height="10" fill="var(--c10one)"></rect>
                        </clipPath>
                        </defs>
                       </svg>
                        {{ time }}
                    </span>
                    <!--стоимость перелёта-->
                    <span class="map__info-btn-cost" style="font-size: 10rem;">
                      <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 20rem;height: 20rem;">
                        <path d="M2.58511 10V0H3.26596V10H2.58511ZM2.85106 8.80851C2.28369 8.80851 1.74113 8.7234 1.2234 8.55319C0.705674 8.37589 0.297872 8.14894 0 7.87234L0.393617 7.04255C0.677305 7.29078 1.03901 7.49645 1.47872 7.65957C1.91844 7.8227 2.37589 7.90426 2.85106 7.90426C3.28369 7.90426 3.63475 7.85461 3.90426 7.75532C4.17376 7.65603 4.37234 7.52128 4.5 7.35106C4.62766 7.17376 4.69149 6.97518 4.69149 6.75532C4.69149 6.5 4.60638 6.29433 4.43617 6.1383C4.27305 5.98227 4.05674 5.85816 3.78723 5.76596C3.52482 5.66667 3.23404 5.58156 2.91489 5.51064C2.59574 5.43972 2.27305 5.35816 1.94681 5.26596C1.62766 5.16667 1.33333 5.04255 1.06383 4.89362C0.801418 4.74468 0.588652 4.5461 0.425532 4.29787C0.262411 4.04255 0.180851 3.71631 0.180851 3.31915C0.180851 2.93617 0.280142 2.58511 0.478723 2.26596C0.684397 1.93972 0.996454 1.68085 1.41489 1.48936C1.84043 1.29078 2.37943 1.19149 3.03191 1.19149C3.46454 1.19149 3.89362 1.24823 4.31915 1.3617C4.74468 1.47518 5.11348 1.6383 5.42553 1.85106L5.07447 2.70213C4.75532 2.48936 4.41844 2.33688 4.06383 2.24468C3.70922 2.14539 3.36525 2.09574 3.03191 2.09574C2.61348 2.09574 2.2695 2.14894 2 2.25532C1.7305 2.3617 1.53191 2.50355 1.40426 2.68085C1.28369 2.85816 1.2234 3.05674 1.2234 3.2766C1.2234 3.53901 1.30496 3.74823 1.46809 3.90426C1.6383 4.06028 1.85461 4.1844 2.11702 4.2766C2.38652 4.36879 2.68085 4.4539 3 4.53191C3.31915 4.60284 3.6383 4.6844 3.95745 4.7766C4.28369 4.86879 4.57801 4.98936 4.84043 5.1383C5.10993 5.28723 5.32624 5.48582 5.48936 5.73404C5.65248 5.98227 5.73404 6.30142 5.73404 6.69149C5.73404 7.06738 5.63121 7.41844 5.42553 7.74468C5.21986 8.06383 4.90071 8.3227 4.46809 8.52128C4.04255 8.71277 3.50355 8.80851 2.85106 8.80851Z" fill="var(--c10one)"></path>
                      </svg>
                      {{ cost }}
                    </span>
                </div>
                {% endif %}

            {% else %}
              <p class="profile__repost-status" style="width: 100%; max-width: 144rem; margin: inherit;">в полёте</p>
            {% endif %}
        {% else %}
            {% if not player.destination %}
                {% if player.region == region %}
                    <p class="profile__repost-status" style="width: 100%; max-width: 144rem; margin: inherit;">регион прописки</p>
                {% else %}
                    <div class="map__info-btn-block" style="justify-content: inherit; width: 210rem;">
                        {% csrf_token %}
                        <input type="hidden" class="region_id" name="region" value="{% localize off %}{{ region.pk }}{% endlocalize %}">
                        <button class="to_fly" style="cursor: pointer; width: 100rem;height: 24rem;font-size: 12rem;">{% trans 'отправиться' context "map" %}</button>
                        <!--время перелёта-->
                        <span class="map__info-btn-time" style="font-size: 10rem;">
                          <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 20rem;height: 20rem;">
                            <g clip-path="url(#clip0_1186_860)">
                            <path d="M4.99997 9.64265C7.56415 9.64265 9.64283 7.56397 9.64283 4.99979C9.64283 2.43561 7.56415 0.356934 4.99997 0.356934C2.43579 0.356934 0.357117 2.43561 0.357117 4.99979C0.357117 7.56397 2.43579 9.64265 4.99997 9.64265Z" stroke="var(--c10one)"></path>
                            <path d="M5 1.6001V5.0501L7.65 7.7001" stroke="var(--c10one)"></path>
                            </g>
                            <defs>
                            <clipPath id="clip0_1186_860">
                            <rect width="10" height="10" fill="var(--c10one)"></rect>
                            </clipPath>
                            </defs>
                           </svg>
                            {{ time }}
                        </span>
                        <!--стоимость перелёта-->
                        <span class="map__info-btn-cost" style="font-size: 10rem;">
                          <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 20rem;height: 20rem;">
                            <path d="M2.58511 10V0H3.26596V10H2.58511ZM2.85106 8.80851C2.28369 8.80851 1.74113 8.7234 1.2234 8.55319C0.705674 8.37589 0.297872 8.14894 0 7.87234L0.393617 7.04255C0.677305 7.29078 1.03901 7.49645 1.47872 7.65957C1.91844 7.8227 2.37589 7.90426 2.85106 7.90426C3.28369 7.90426 3.63475 7.85461 3.90426 7.75532C4.17376 7.65603 4.37234 7.52128 4.5 7.35106C4.62766 7.17376 4.69149 6.97518 4.69149 6.75532C4.69149 6.5 4.60638 6.29433 4.43617 6.1383C4.27305 5.98227 4.05674 5.85816 3.78723 5.76596C3.52482 5.66667 3.23404 5.58156 2.91489 5.51064C2.59574 5.43972 2.27305 5.35816 1.94681 5.26596C1.62766 5.16667 1.33333 5.04255 1.06383 4.89362C0.801418 4.74468 0.588652 4.5461 0.425532 4.29787C0.262411 4.04255 0.180851 3.71631 0.180851 3.31915C0.180851 2.93617 0.280142 2.58511 0.478723 2.26596C0.684397 1.93972 0.996454 1.68085 1.41489 1.48936C1.84043 1.29078 2.37943 1.19149 3.03191 1.19149C3.46454 1.19149 3.89362 1.24823 4.31915 1.3617C4.74468 1.47518 5.11348 1.6383 5.42553 1.85106L5.07447 2.70213C4.75532 2.48936 4.41844 2.33688 4.06383 2.24468C3.70922 2.14539 3.36525 2.09574 3.03191 2.09574C2.61348 2.09574 2.2695 2.14894 2 2.25532C1.7305 2.3617 1.53191 2.50355 1.40426 2.68085C1.28369 2.85816 1.2234 3.05674 1.2234 3.2766C1.2234 3.53901 1.30496 3.74823 1.46809 3.90426C1.6383 4.06028 1.85461 4.1844 2.11702 4.2766C2.38652 4.36879 2.68085 4.4539 3 4.53191C3.31915 4.60284 3.6383 4.6844 3.95745 4.7766C4.28369 4.86879 4.57801 4.98936 4.84043 5.1383C5.10993 5.28723 5.32624 5.48582 5.48936 5.73404C5.65248 5.98227 5.73404 6.30142 5.73404 6.69149C5.73404 7.06738 5.63121 7.41844 5.42553 7.74468C5.21986 8.06383 4.90071 8.3227 4.46809 8.52128C4.04255 8.71277 3.50355 8.80851 2.85106 8.80851Z" fill="var(--c10one)"></path>
                          </svg>
                          {{ cost }}
                        </span>
                    </div>
                {% endif %}
            {% else %}
              <p class="profile__repost-status" style="width: 100%; max-width: 144rem; margin: inherit;">в полёте</p>
            {% endif %}
        {% endif %}

      </div><!--конец инфа в топ блоке-->

    </div><!--конец ТОП блок-->

		<div class="party__regionInfo">
			<div class="party__regionInfo-block">
                <p>Жителей: <span>{{ players_count }}</span></p>
                <p>Граждан: <span>{{ residents_count }}</span></p>
                <p>Партий: <span>{{ parties_count }}</span></p>
			</div>

			<div class="party__mmid-line"></div>

            <div class="party__regionInfo-block">
				<p>{% trans 'Запасы золота' %}: <span>{{ region.gold_has }} / {{ region.gold_cap }}</span></p>
				<p>{% trans 'Запасы нефти' %}: <span>{{ region.oil_has }} / {{ region.oil_cap }}</span></p>
				<p>{% trans 'Марка нефти' %}: <span>{{ region.oil_mark.name }}</span></p>
				<p>Запасы руд: <span>{{ region.ore_has }} / {{ region.ore_cap }}</span></p>
				<p>Качество руды:</p>
				<p>(уголь / железо / бокситы)<span>{% for fossil in fossils %}{{ fossil.percent }} % {% if not forloop.last %} / {% endif %}{% endfor %}</span></p>
			</div>

			<div class="party__mmid-line"></div>

            {% for building_cl in building_classes %}
                {% get_building_info %}
                <div class="party__mmid-line"></div>
            {% endfor %}

			<div class="party__regionInfo-block">
				<h2>{% trans 'Региональные налоги' %}:</h2>
				<p>{% trans 'На финансирование' %}: <span>{{ region.cash_tax }} %</span></p>
				<p>{% trans 'На добычу' %} (нефть / руда): <span>{{ region.oil_tax }} % / {{ region.ore_tax }} %</span></p>
				<p>{% trans 'На торговлю' %}: <span>{{ region.trade_tax }} %</span></p>
			</div>
		</div>

	</section>
{% endblock %}